# –û—Ç—á–µ—Ç: –ö—Ä–∏—Ç–∏—á–Ω–æ–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ —Å—Ç–∞—Ç—É—Å–∞ –∏–≥—Ä—ã –≤ –∞–¥–º–∏–Ω–∫–µ

## –ü—Ä–æ–±–ª–µ–º–∞
–ü—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏–≥—Ä—ã –≤ –∞–¥–º–∏–Ω–∫–µ (–∏–∑–º–µ–Ω–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤) —Å—Ç–∞—Ç—É—Å –∏–≥—Ä—ã –Ω–µ –æ–±–Ω–æ–≤–ª—è–ª—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, —á—Ç–æ –ø—Ä–∏–≤–æ–¥–∏–ª–æ –∫ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É –ø–æ–≤–µ–¥–µ–Ω–∏—é —Å–∏—Å—Ç–µ–º—ã.

## –û–±–Ω–∞—Ä—É–∂–µ–Ω–Ω—ã–µ –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –Ω–µ–¥–æ—Å—Ç–∞—Ç–∫–∏

### 1. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ª–æ–≥–∏–∫–∏ –≤ `GameService.update_game()`**
```python
# ‚ùå –ë–´–õ–û: –ü—Ä–æ—Å—Ç–æ –∏–∑–º–µ–Ω—è–ª—Å—è max_participants –±–µ–∑ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
game.max_participants = max_participants
db.commit()
```

### 2. **–ù–µ–ø–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ admin —Ñ—É–Ω–∫—Ü–∏—è—Ö**
–§—É–Ω–∫—Ü–∏–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è/—É–¥–∞–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–ª–∏ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Å—Ç–∞—Ç—É—Å –∏–≥—Ä—ã.

## –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

### 1. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ `GameService.update_game()`**
```python
# ‚úÖ –°–¢–ê–õ–û: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–ª–Ω–∞—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
if max_participants is not None:
    # –ü–æ–ª—É—á–∞–µ–º –∞–∫—Ç—É–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
    actual_participants = db.query(GameParticipant).filter(GameParticipant.game_id == game_id).count()
    
    # –õ–æ–≥–∏–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∏–≥—Ä—ã –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
    if actual_participants >= game.max_participants:
        # –î–æ—Å—Ç–∏–≥–Ω—É—Ç –ª–∏–º–∏—Ç —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ - –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤ UPCOMING
        if game.status == GameStatus.RECRUITING:
            game.status = GameStatus.UPCOMING
            db.commit()
    else:
        # –õ–∏–º–∏—Ç –Ω–µ –¥–æ—Å—Ç–∏–≥–Ω—É—Ç - –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤ RECRUITING (–µ—Å–ª–∏ –±—ã–ª–∞ –≤ UPCOMING)
        if game.status == GameStatus.UPCOMING:
            game.status = GameStatus.RECRUITING
            db.commit()
```

### 2. **–î–æ–ø–æ–ª–Ω–µ–Ω–∞ `ManualGameControlService.add_participant_to_game()`**
```python
# ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ—Å–ª–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞
if actual_participants >= updated_game.max_participants and updated_game.status == GameStatus.RECRUITING:
    updated_game.status = GameStatus.UPCOMING
    db.commit()
```

### 3. **–î–æ–ø–æ–ª–Ω–µ–Ω–∞ `ManualGameControlService.remove_participant_from_game()`**
```python
# ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ –ø–æ—Å–ª–µ —É–¥–∞–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞
if updated_game.status == GameStatus.UPCOMING and actual_participants < updated_game.max_participants:
    updated_game.status = GameStatus.RECRUITING
    db.commit()
```

## –°—Ü–µ–Ω–∞—Ä–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞—é—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ò–∑–º–µ–Ω–µ–Ω–∏–µ max_participants –≤ –∞–¥–º–∏–Ω–∫–µ
- **–î–æ**: –ò–≥—Ä–∞ RECRUITING (3/5 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤) ‚Üí –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ max=3 ‚Üí –û—Å—Ç–∞–µ—Ç—Å—è RECRUITING ‚ùå
- **–ü–æ—Å–ª–µ**: –ò–≥—Ä–∞ RECRUITING (3/5 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤) ‚Üí –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ max=3 ‚Üí UPCOMING ‚úÖ

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: –£–º–µ–Ω—å—à–µ–Ω–∏–µ max_participants
- **–î–æ**: –ò–≥—Ä–∞ UPCOMING (3/3 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤) ‚Üí –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ max=5 ‚Üí –û—Å—Ç–∞–µ—Ç—Å—è UPCOMING ‚ùå
- **–ü–æ—Å–ª–µ**: –ò–≥—Ä–∞ UPCOMING (3/3 —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤) ‚Üí –ò–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–∞ max=5 ‚Üí RECRUITING ‚úÖ

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∞–¥–º–∏–Ω–æ–º
- **–î–æ**: –ù–µ –≤—Å–µ–≥–¥–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –æ–±–Ω–æ–≤–ª—è–ª—Å—è —Å—Ç–∞—Ç—É—Å
- **–ü–æ—Å–ª–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ UPCOMING –ø—Ä–∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞ ‚úÖ

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: –£–¥–∞–ª–µ–Ω–∏–µ —É—á–∞—Å—Ç–Ω–∏–∫–∞ –∞–¥–º–∏–Ω–æ–º
- **–î–æ**: –ú–æ–≥–ª–∞ –æ—Å—Ç–∞—Ç—å—Å—è –≤ UPCOMING –¥–∞–∂–µ —Å –Ω–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤
- **–ü–æ—Å–ª–µ**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ—Ö–æ–¥ –≤ RECRUITING –ø—Ä–∏ —Å–Ω–∏–∂–µ–Ω–∏–∏ –Ω–∏–∂–µ –ª–∏–º–∏—Ç–∞ ‚úÖ

## –õ–æ–≥–∏–∫–∞ —Å—Ç–∞—Ç—É—Å–æ–≤ –∏–≥—Ä—ã

| –°—Ç–∞—Ç—É—Å | –û–ø–∏—Å–∞–Ω–∏–µ | –£—Å–ª–æ–≤–∏–µ |
|--------|----------|---------|
| `RECRUITING` | –ù–∞–±–æ—Ä —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ | `—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ < max_participants` |
| `UPCOMING` | –ì–æ—Ç–æ–≤–∞ –∫ –Ω–∞—á–∞–ª—É | `—É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ >= max_participants` |
| `HIDING_PHASE` | –ò–≥—Ä–∞ –Ω–∞—á–∞–ª–∞—Å—å, —Ñ–∞–∑–∞ –ø—Ä—è—Ç–æ–∫ | –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä –∑–∞–ø—É—Å—Ç–∏–ª –∏–≥—Ä—É |
| `SEARCHING_PHASE` | –§–∞–∑–∞ –ø–æ–∏—Å–∫–∞ | –í—Å–µ –≤–æ–¥–∏—Ç–µ–ª–∏ —Å–ø—Ä—è—Ç–∞–ª–∏—Å—å |
| `COMPLETED` | –ò–≥—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ | –í—Å–µ –Ω–∞–π–¥–µ–Ω—ã –∏–ª–∏ –≤—Ä–µ–º—è –≤—ã—à–ª–æ |
| `CANCELED` | –ò–≥—Ä–∞ –æ—Ç–º–µ–Ω–µ–Ω–∞ | –û—Ç–º–µ–Ω–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–æ–º |

## –í–ª–∏—è–Ω–∏–µ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

### ‚úÖ **–¢–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:**
1. **–ê–¥–º–∏–Ω–∫–∞**: –°—Ç–∞—Ç—É—Å –∏–≥—Ä—ã –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª–µ–Ω –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
2. **–£—á–∞—Å—Ç–Ω–∏–∫–∏**: –í–∏–¥—è—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Å—Ç–∞—Ç—É—Å –∏–≥—Ä—ã
3. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è**: –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ —Ä–∞–±–æ—Ç–∞—é—Ç –Ω–∞ –æ—Å–Ω–æ–≤–µ –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ —Å—Ç–∞—Ç—É—Å–∞
4. **–õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã**: –í—Å–µ –ø–µ—Ä–µ—Ö–æ–¥—ã –º–µ–∂–¥—É —Å—Ç–∞—Ç—É—Å–∞–º–∏ —Ä–∞–±–æ—Ç–∞—é—Ç –∫–∞–∫ –æ–∂–∏–¥–∞–µ—Ç—Å—è

### üöÄ **–†–µ–∑—É–ª—å—Ç–∞—Ç:**
- –£—Å—Ç—Ä–∞–Ω–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–Ω–∞—è –æ—à–∏–±–∫–∞ –≤ –ª–æ–≥–∏–∫–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–≥—Ä–∞–º–∏
- –°—Ç–∞—Ç—É—Å –∏–≥—Ä—ã —Ç–µ–ø–µ—Ä—å **–í–°–ï–ì–î–ê** –∞–∫—Ç—É–∞–ª–µ–Ω –∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
- –ê–¥–º–∏–Ω–∫–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–æ –≤–æ –≤—Å–µ—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ª–æ–≥–∏–∫–æ–π –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∏–≥—Ä—ã —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∞

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `src/services/game_service.py` - –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞
- `src/services/manual_game_control_service.py` - –î–æ–ø–æ–ª–Ω–µ–Ω–∏—è –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π

**–ö–æ–º–º–∏—Ç:** `f581076` - –ö–†–ò–¢–ò–ß–ù–û–ï –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–æ–±–∞–≤–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∏–≥—Ä—ã –ø—Ä–∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –≤ –∞–¥–º–∏–Ω–∫–µ

**–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:** –õ–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–µ–Ω–∞ –Ω–∞ –≤—Å–µ—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å—Ü–µ–Ω–∞—Ä–∏—è—Ö –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –∞–¥–º–∏–Ω–∫–∏ 